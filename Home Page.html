<!DOCTYPE html>
<!-- saved from url=(0024)http://ssz.tingcoin.com/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Apple devices fullscreen -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <!-- Apple devices fullscreen -->
    <meta names="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Home Page</title>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="./Home Page_files/bootstrap.min.css">
    <!-- Bootstrap responsive -->
    <link rel="stylesheet" href="./Home Page_files/bootstrap-responsive.min.css">
    <!-- jQuery UI -->
    <link rel="stylesheet" href="./Home Page_files/jquery-ui.css">
    <link rel="stylesheet" href="./Home Page_files/jquery.ui.theme.css">
    <!-- PageGuide -->
    <link rel="stylesheet" href="./Home Page_files/pageguide.css">
    <!-- Fullcalendar -->
    <link rel="stylesheet" href="./Home Page_files/fullcalendar.css">
    <link rel="stylesheet" href="./Home Page_files/fullcalendar.print.css" media="print">
    <!-- chosen -->
    <link rel="stylesheet" href="./Home Page_files/chosen.css">
    <!-- select2 -->
    <link rel="stylesheet" href="./Home Page_files/select2.css">
    <!-- icheck -->
    <link rel="stylesheet" href="./Home Page_files/all.css">
    <!-- Theme CSS -->
    <link rel="stylesheet" href="./Home Page_files/style.css">
    <!-- Color CSS -->
    <link rel="stylesheet" href="./Home Page_files/themes.css">
    <!-- jQuery -->
    <script src="./Home Page_files/jquery.min.js"></script>
    <!-- Nice Scroll -->
    <script src="./Home Page_files/jquery.nicescroll.min.js"></script>
    <!-- jQuery UI -->
    <script src="./Home Page_files/jquery.ui.core.min.js"></script>
    <script src="./Home Page_files/jquery.ui.widget.min.js"></script>
    <script src="./Home Page_files/jquery.ui.mouse.min.js"></script>
    <script src="./Home Page_files/jquery.ui.draggable.min.js"></script>
    <script src="./Home Page_files/jquery.ui.resizable.min.js"></script>
    <script src="./Home Page_files/jquery.ui.sortable.min.js"></script>
    <!-- Touch enable for jquery UI -->
    <script src="./Home Page_files/jquery.touch-punch.min.js"></script>
    <!-- slimScroll -->
    <script src="./Home Page_files/jquery.slimscroll.min.js"></script>
    <!-- Bootstrap -->
    <script src="./Home Page_files/bootstrap.min.js"></script>
    <!-- vmap -->
    <script src="./Home Page_files/jquery.vmap.min.js"></script>
    <script src="./Home Page_files/jquery.vmap.world.js"></script>
    <script src="./Home Page_files/jquery.vmap.sampledata.js"></script>
    <!-- Bootbox -->
    <script src="./Home Page_files/jquery.bootbox.js"></script>
    <!-- Flot -->
    <script src="./Home Page_files/jquery.flot.min.js"></script>
    <script src="./Home Page_files/jquery.flot.bar.order.min.js"></script>
    <script src="./Home Page_files/jquery.flot.pie.min.js"></script>
    <script src="./Home Page_files/jquery.flot.resize.min.js"></script>
    <!-- imagesLoaded -->
    <script src="./Home Page_files/jquery.imagesloaded.min.js"></script>
    <!-- PageGuide -->
    <script src="./Home Page_files/jquery.pageguide.js"></script>
    <!-- FullCalendar -->
    <script src="./Home Page_files/fullcalendar.min.js"></script>
    <!-- Chosen -->
    <script src="./Home Page_files/chosen.jquery.min.js"></script>
    <!-- select2 -->
    <script src="./Home Page_files/select2.min.js"></script>
    <!-- icheck -->
    <script src="./Home Page_files/jquery.icheck.min.js"></script>
    <!-- Theme framework -->
    <script src="./Home Page_files/eakroko.min.js"></script>
    <!-- Theme scripts -->
    <script src="./Home Page_files/application.min.js"></script>
    <!-- Just for demonstration -->
    <script src="./Home Page_files/demonstration.min.js"></script>
    <!--[if lte IE 9]>
    <script src="~/Content/ssz/flat/js/plugins/placeholder/jquery.placeholder.min.js"></script>
    <script>
        $(document).ready(function () {
            $('input, textarea').placeholder();
        });
    </script>
    <![endif]-->
    <!-- Favicon -->
    <link rel="shortcut icon" href="http://ssz.tingcoin.com/Content/ssz/flat/img/favicon.ico">
    <!-- Apple devices Homescreen icon -->
    <link rel="apple-touch-icon-precomposed" href="http://ssz.tingcoin.com/Content/ssz/flat/img/apple-touch-icon-precomposed.png">
    <link rel="stylesheet" href="./Home Page_files/new.css">
    <script src="./Home Page_files/jquery.jspeech.js"></script>
    <script src="./Home Page_files/tableScript.js"></script>
    <style>
        body {
        font-family: "Microsoft YaHei";
    }
    </style>
    <script>
        function SendMessage() {
            text = document.getElementById('message').value;
            $.post("/api/Message", { Message1: text, UserId: "42ef2de8-6bdd-4295-8dfd-5268e871881f" });
            ClearMessage();
        }
        function ClearMessage(){
            document.getElementById('message').value = "";
        }
    </script>

<script data-require-id="echarts/chart/line" src="./Home Page_files/line.js" async=""></script><script data-require-id="echarts/chart/bar" src="./Home Page_files/bar.js" async=""></script>

    <script type="text/javascript" src = "Home Page_files/tableScript.js"></script>
    </head>
<body>
    <div id="navigation">
        <div class="container-fluid">
            <a href="http://ssz.tingcoin.com/#" id="brand">声声赚</a>
            <ul class="main-nav">
                <li>
                    <a href="http://ssz.tingcoin.com/">
                        <span>行情吐槽</span>
                    </a>
                </li>
                <li>
                    <a href="http://ssz.tingcoin.com/Home/Voice">
                        <span>声客汇</span>
                    </a>
                </li>
                <li>
                    <a href="http://ssz.tingcoin.com/Home/KLine">
                        <span>K线训练</span>
                    </a>
                </li>
            </ul>
            <div class="user">
                <div class="dropdown">
                    <a href="http://ssz.tingcoin.com/#" class="dropdown-toggle" data-toggle="dropdown">
                        四十二号漫游员 
                        
                    </a>
                    <ul class="dropdown-menu pull-right">
                        
                        <li>
                            <a href="http://ssz.tingcoin.com/Account/LogOff">登出</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    <ul class="mobile-nav"><li><a href="http://ssz.tingcoin.com/">行情吐槽</a></li><li><a href="http://ssz.tingcoin.com/Home/Voice">声客汇</a></li><li><a href="http://ssz.tingcoin.com/Home/KLine">K线训练</a></li></ul></div>
    <div class="container-fluid" id="content" style="min-height: auto; height: 871px;">
        <div id="left" class="ui-sortable ui-resizable">
            
            <div class="subnav">
                <div class="subnav-title">
                    <a href="http://ssz.tingcoin.com/#" class="toggle-subnav"><i class="icon-angle-down"></i><span>导航</span></a>
                </div>
                <ul class="subnav-menu">
                    <li>
                        <a href="http://ssz.tingcoin.com/Home/MyProfile">我的主页</a>
                    </li>
                    <li>
                        <a href="http://ssz.tingcoin.com/Home/MyStock">我的自选</a>
                    </li>
                    <li>
                        <a href="http://ssz.tingcoin.com/Home/People">热门关注</a>
                    </li>
                    <li>
                        <a href="http://ssz.tingcoin.com/Home/WeChatConnect">微信绑定</a>
                    </li>
                </ul>
            </div>
        <div class="ui-resizable-handle ui-resizable-e" style="z-index: 90; height: 871px;"></div></div>
        <div id="bottom" class="navbar-fixed-bottom " style=" background: #eee;margin-top:0px;">
            <div id="xx" class="box-content">
                <div>
                    <textarea name="textarea" id="message" class="input-block-level" placeholder="我要说(Ctrl+Enter发送)" onkeydown="if (event.keyCode == 13 &amp;&amp; event.ctrlKey) { SendMessage() }"></textarea>
                </div>
                <div>
                    <button type="submit" class="btn btn-danger" onclick="SendMessage()">发送</button>
                    <button type="button" class="btn btn-inverse" onclick="ClearMessage()">Cancel</button>
                </div>
            </div>
        </div>
        


    <div id="main">
        <div class="container-fluid">
            <div class="page-header">
                <div class="pull-left">
                    <h1>首页</h1>
                </div>
                <div class="pull-right">
                    <ul class="stats">
                        
                        <li class="lightred">
                            <i class="icon-calendar"></i>
                            <div class="details">
                                <span class="big">July 25, 2016</span>
                                <span>Monday, 20:17</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="breadcrumbs">
                <ul>
                    <li>
                        <a href="http://ssz.tingcoin.com/">首页</a>
                        <i class="icon-angle-right"></i>
                    </li>
                    <li>
                        <a href="http://ssz.tingcoin.com/">行情吐槽</a>
                    </li>
                </ul>
                <div class="close-bread">
                    <a href="http://ssz.tingcoin.com/#"><i class="icon-remove"></i></a>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span9" id="x">
                    <div class="box box-color box-bordered" onload="SetSize()">
                        <div class="box-title">
                            <h3>
                                <i class="icon-bar-chart"></i>
                                今日走势
                            </h3>
                        </div>
                        <div class="box-content" style="height:400px;">
                            <div class="statistic-big" style="position:relative;height:inherit;">
                                <div class="top" style="z-index:1000;position:relative;">
                                    <div class="left">
                                         <h4 id="stockName">上证指数</h4></div>
                                    <div style="z-index:100;position: relative;top:15px;left: 40px;">
                                        <b> 当前价格:
                                            <span>1212</span></b>
                                        <b>成交量:
                                            <span> 1313</span></b></div>

                                    <div style="position:relative;float:right;">
                                        <input id="Code" type="text" placeholder="stockCode" class="input-small" style="z-index:200;margin:10px;" onkeypress="if (event.keyCode == 13) { changeStock(); }">
                                        <button class="btn" onclick="changeStock();">转到</button>
                                        <button class="btn btn-primary" onclick="AddStock();"><i class="icon-plus"></i>加自选</button>
                                    </div>
                                </div>
                                <div class="bottom" style="margin-top:-20px;height:400px;z-index:1;position:absolute;">
                                    <div id="chart" style="margin: -20px; height: 400px; width: 1274px; -webkit-tap-highlight-color: transparent; -webkit-user-select: none; background-color: rgba(0, 0, 0, 0);" _echarts_instance_="1469449011828"><div style="position: relative; overflow: hidden; width: 1274px; height: 400px;"><div data-zr-dom-id="bg" class="zr-element" style="position: absolute; left: 0px; top: 0px; width: 1274px; height: 400px; -webkit-user-select: none;"></div><canvas width="1274" height="400" data-zr-dom-id="0" class="zr-element" style="position: absolute; left: 0px; top: 0px; width: 1274px; height: 400px; -webkit-user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></canvas><canvas width="1274" height="400" data-zr-dom-id="1" class="zr-element" style="position: absolute; left: 0px; top: 0px; width: 1274px; height: 400px; -webkit-user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></canvas><canvas width="1274" height="400" data-zr-dom-id="_zrender_hover_" class="zr-element" style="position: absolute; left: 0px; top: 0px; width: 1274px; height: 400px; -webkit-user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></canvas></div></div>
                                </div>
                                <div class="bottom" style="margin-top:-20px;height:400px;z-index:2;position:absolute;">
                                    <div id="play" style="margin: -20px; height: 400px; width: 1274px;">
                                        <div id="danmuarea">
                                            <div id="danmu" style="margin: -20px; position: absolute; left: 0px; top: 0px; width: 100%; height: 100%; z-index: 100; color: rgb(255, 255, 255); overflow: hidden;">
                                            <div class="danmakuTimer"></div></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="span3">
                    <div class="box box-color lightred box-bordered">
                        <div class="box-title">
                            <h3>
                                <i class="icon-chevron-right"></i>
                                弹幕区
                            </h3>
                        </div>
                        <div class="box-content" style="padding:2px;height:436px;">
                            <div class="statistic-big">
                                <div class="top">
                                    <div id="DanmuText" style="height:300px;font-size:10px;overflow-y:auto;text-align:left;
										margin-left:20px;margin-top:10px;">
                                    </div>
                                </div>
                                <div class="bottom" style="margin-top:0">
                                    <div class="input-group">
                                        <textarea type="text" class="form-control" id="text" maxlength="15" placeholder="..." style="width:92%;"></textarea>
                                        <span class="input-group-btn">
                                            <button type="button" class=" btn btn-default" onclick="send()">
                                                发送
                                            </button>
                                        </span>
                                        <button id="changebtn" type="button" class="btn btn-blue " style="font-size: smaller;" onclick="change()">
                                            关闭弹幕
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    <div class="box box-color box-bordered green">
                        <div class="box-title">
                            <h3>
                                <i class="glyphicon-chat"></i>
                                我的关注
                            </h3>
                        </div>

                        <div class="box-content">
                                <div class="statistic-big">
                                    <div class="top">

                                        <br>
                                        <table id = "test" border="1" style="color: forestgreen;">
                                        <tbody>
                                            <tr>
                                                <td>优先级</td>
                                                <td>声客</td>
                                                <td>消息</td>
                                                <td>时间</td>
                                            </tr>
                                        </table>
                                        </tbody>
                                        <br>
                                        <script>
                                            createTable("Miller/Ryan/Tim/Lana", "what?/Come on/tell you what/Fine", "10:00/12:00/13:00/14:00");
                                        </script>
                                    </div>
                                        <div class="left">
                                            <div class="input-medium">
                                                <select id="Subscribe" name="category" class="chosen-select chzn-done" data-nosearch="true" onchange="getSubs();" style="display: none;">
                                                    <option value="-1" selecte=""></option>
                                                </select><div id="Subscribe_chzn" class="chzn-container chzn-container-single chzn-container-single-nosearch" style="width: 150px;" title=""><a href="javascript:void(0)" class="chzn-single chzn-default" tabindex="-1"><span>Select an Option</span><div><b></b></div></a><div class="chzn-drop" style="left: -9000px; width: 148px; top: 31px;"><div class="chzn-search"><input type="text" autocomplete="off" style="width: 113px;"></div><ul class="chzn-results"></ul></div></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="subcontent" class="bottom">
                                            <p class="jcontent"></p>
                                    </div>
                                </div>
                        </div>
                    </div>
                </div>
            </div>
            <div style="margin-top:100px"></div>
        </div>
    </div>


    
        <script src="./Home Page_files/jquery.jspeech.js"></script>
        <style>
            #play {
                height: 500px;
                background: transparent;
            }


            #speech {
                margin-top: 15px;
                margin-bottom: 15px;
                float: left;
                margin-right: 15px;
                margin-left: 15px;
                color: #9d9d9d;
            }
        </style>
        <!--jquery.danmu.js (//github.com/chiruom/danmu/) - Licensed under the MIT license-->
        <script src="./Home Page_files/jquery.danmu.min.js"></script>
        <script src="./Home Page_files/echarts.js"></script>
        <!--语音-->
        <script>
        $(document).ready(function () {
            //$(".jcontent").jspeech({
            //    "jspeech_a": true,
            //    "jspeech_a_width": "30px"/*"16px"*/,
            //    "jspeech_a_height": "13px",
            //    /*"jspeech_a_png":"url(./image/icon.png) no-repeat",*/
            //    "jspeech_content": "测试"
            //});
        });
        </script>
        <!--图表-->
        <script type="text/javascript">

            var id = 'sh1A0001';
            //var id = 'sz002464';
            var userName = "四十二号漫游员";
            var userId = "42ef2de8-6bdd-4295-8dfd-5268e871881f";
            console.log(userId);
            console.log(userName);
            function AddStock() {
                $.post("/api/StockList", { UserId: "42ef2de8-6bdd-4295-8dfd-5268e871881f", StockCode: id, Method: 1 });
            }
            var myChart;

            function DrawChart(sid) {
                var container = [];
                var a = new Date();
                a = a.toLocaleDateString();
                b = new Date(a);
                c = b.getTime() + 3600 * 1000 * 9.5;
                timeContainer = [];
                for (i = 0; i < 242; i++) {
                    if (i == 120) {
                        container[i] = [i, "-"];
                        //container[i] = [new Date(c), "-"];
                        timeContainer[i] = container[i][0];
                        c += 5400000;
                    }
                    else {
                        container[i] = [i, "-"];
                        //container[i] = [new Date(c), "-"];
                        timeContainer[i] = container[i][0];
                        c += 60000;
                    }
                }
                //console.log(container);
                require.config({
                    paths: {
                        echarts: './Content/ssz/flat/build/dist'
                    }
                });
                require(
                   [
                       'echarts',
                       'echarts/chart/line',   // 按需加载所需图表，如需动态类型切换功能，别忘了同时加载相应图表
                       'echarts/chart/bar'
                   ],
                   function (ec) {
                       var timeLatest;
                       SetSize();
                       myChart = ec.init(document.getElementById('chart'));
                       option = {
                           title: {
                               /*text: '000001.SZ:上证综指',*/
                               /*subtext: '纯属虚构'*/
                           },
                           tooltip: {
                               trigger: 'axis',
                           },
                           /*legend: {
                            data:['price']
                            },*/
                           toolbox: {
                               show: false,
                               feature: {
                                   mark: { show: true },
                                   dataView: { show: true, readOnly: false },
                                   magicType: { show: true, type: ['line', 'bar'] },
                                   restore: { show: true },
                                   saveAsImage: { show: true }
                               }
                           },
                           calculable: false,
                           xAxis: [
                               {
                                   show: false,
                                   type: 'value',
                                   position: 'top',
                                   boundaryGap: false,
                                   min: 0,
                                   max: 242,
                               },
                               {
                                   show: true,
                                   type: 'category',
                                   position: 'bottom',
                                   boundaryGap: false,
                                   data: ['9:30', '10:30', '11:30/13:00', '14:00', '15:00']
                               }

                           ],
                           yAxis: [
                               {
                                   /*axisLabel : {
                                    formatter: '{value} °C'
                                    }*/
                                   scale: true
                               }
                           ],
                           series: [
                               {
                                   name: 'price',
                                   type: 'line',
                                   data: (function () {
                                       var d = container;
                                       $.ajax({
                                           type: 'GET',
                                           url: '/api/StockData/' + id,
                                           dataType: 'json',
                                           success: function (data, textStatus) {
                                               $.each(data, function (i) {
                                                   //res = Math.floor((new Date(data[i].dateTime) - 8 * 1000 * 3600 - b.getTime() - 3600 * 1000 * 9.5) / 60000);
                                                   //console.log(res);
                                                   //console.log(new Date(data[i].dateTime) - 8 * 1000 * 3600);
                                                   //console.log(new Date(data[i].dateTime) - 8 * 1000 * 3600);
                                                   res = data[i].no;
                                                   //console.log(res);
                                                   if (res >= 0 && res <= 120) {
                                                       container[res][1] = data[i].Price;
                                                   }
                                                   else if (res >= 210 && res <= 330) {
                                                       container[res - 89][1] = data[i].Price;
                                                   }
                                               });
                                               myChart.setOption(option);
                                               //console.log(d);
                                           },
                                           error: function (xmlHttpRequest, textStatus, errorThrown) {
                                               console.log(errorThrown);
                                           }
                                       });
                                       console.log("11111111");
                                       return d;
                                   })(),
                                   /*markPoint : {
                                    data : [
                                    {type : 'max', name: '最大值'},
                                    {type : 'min', name: '最小值'}
                                    ]
                                    },*/
                                   markLine: {
                                       data: [
                                           { type: 'average', name: '平均值' }
                                       ]
                                   },
                                   symbol: 'none',
                                   showAllSymbol: false
                               }
                           ],
                       };
                       timeTicket = setInterval(function () {
                           var e = [];
                           $.ajax({
                               type: 'GET',
                               url: '/api/StockData/?id=' + id + '&number=1',
                               dataType: 'json',
                               success: function (data, textStatus) {
                                   //res = Math.floor((new Date(data.dateTime) - 8 * 1000 * 3600 - b.getTime() - 3600 * 1000 * 9.5) / 60000);
                                   res = data.no;
                                   if (res >= 0 && res <= 120) {
                                       container[res][1] = data.Price;
                                       //console.log(container[res]);
                                       e = container[res]
                                       myChart.addData([
                                           [
                                                0,
                                                container[res],
                                                false,
                                                true,
                                           ]
                                       ]);
                                       //console.log("add");
                                   }
                                   else if (res >= 210 && res <= 330) {
                                       container[res - 89][1] = data.Price;
                                       //console.log(container[res-89]);
                                       myChart.addData([
                                           [
                                                0,
                                                container[res - 89],
                                                false,
                                                true,
                                           ]
                                       ]);
                                       //console.log("add1");
                                   }
                               },
                               error: function (xmlHttpRequest, textStatus, errorThrown) {
                                   console.log(errorThrown);
                               }
                           });
                       }, 3000)
                   }
                );
                console.log("done");
            }
            function GetName(sid) {
                $.getJSON("/api/StockInfo/" + sid, function (data) {
                    $("#stockName").text(data.StockName);
                });
            }
            function SetSize() {
                var wid_str = $('#x').css("width");
                chartWidth = Number(wid_str.substr(0, wid_str.indexOf("p", 0))).toFixed(2);
                $("#chart").css("width", chartWidth + "px");
                $("#play").css("width", chartWidth + "px");
            }
            function GetID() {
                id = document.getElementById("Code").value;
            }
            function Refresh(sid) {
                SetSize();
                id = sid;
                GetName(sid);
                DrawChart(sid);
            }
            $(function () {
                Refresh(id);
                window.onresize = function () {
                    Refresh(id);
                }
            })
            function changeStock() {
                if (document.getElementById("Code").value != "") {
                    id = document.getElementById("Code").value;
                    Refresh(id);
                    document.getElementById("DanmuText").innerHTML = "";
                }
            }


            //弹幕js
            $(function () {
                setInterval("query()", 2000);
                resumer();
            });
            var status = 1;
            function change() {
                if (status == 1) {
                    pauser();
                    document.getElementById("danmu").innerHTML = "";
                    document.getElementById("changebtn").innerHTML = "打开弹幕";
                    status = 0;
                }
                else {
                    resumer();
                    document.getElementById("changebtn").innerHTML = "关闭弹幕";
                    status = 1;
                }
            }
            //初始化
            $("#danmu").danmu({
                left: 0,
                top: 0,
                height: "100%",
                width: "100%",
                speed: 20000,
                opacity: 1,
                font_size_small: 16,
                font_size_big: 24,
                top_botton_danmu_time: 6000
            });
            query();//  从后端获取弹幕并添加

            //再添加三个弹幕
            //$("#danmu").danmu("addDanmu", [
            //    { text: "这是滚动弹幕", color: "white", size: 1, position: 0, time: 2 }
            //    , { text: "这是顶部弹幕", color: "yellow", size: 1, position: 1, time: 2 }
            //    , { text: "这是底部弹幕", color: "red", size: 1, position: 2, time: 2 }
            //]);
            //一个定时器，监视弹幕时间并更新到页面上
            function timedCount() {
                $("#time").text($('#danmu').data("nowTime"));
                t = setTimeout("timedCount()", 500);
            }

            timedCount();
            function starter() {
                $('#danmu').danmu('danmuStart');
            }
            function pauser() {
                $('#danmu').danmu('danmuPause');
            }
            function resumer() {
                $('#danmu').danmu('danmuResume');

            }
            function stoper() {
                $('#danmu').danmu('danmuStop');
            }
            function getime() {
                return ($('#danmu').data("nowTime"));
            }
            function getpaused() {
                alert($('#danmu').data("paused"));
            }
            //添加弹幕测试  这个函数没有调用
            function add() {
                var newd =
                { "text": "new2", "color": "green", "size": "1", "position": "0", "time": 60 };
                $('#danmu').danmu("addDanmu", newd);
            }
            //向后端添加弹幕测试  这个函数没有调用
            function insert() {
                var newd = { "text": "new2", "color": "green", "size": "1", "position": "0", "time": 50 };
                str_newd = JSON.stringify(newd);
                $.post("stone.php", { danmu: str_newd }, function (data, status) {
                    alert(data)
                });
            }
            //从后端获取到弹幕并添加
            function query() {
                $.get("/api/Danmu/" + id, function (data, status) {
                    var danmu_from_sql = eval(data);
                    for (var i = 0; i < danmu_from_sql[0].length; i++) {
                        var danmu_ls = eval('(' + danmu_from_sql[1][i] + ')');
                        var time = parseInt(getime() + Math.ceil(30 * Math.random()));
                        danmu_ls = '{"text":"' + danmu_ls + '","color":"black","size":"1","position":"0","time":' + time + '}';
                        danmu_ls = eval('(' + danmu_ls + ')');
                        if (danmu_from_sql[0][i] != userName) {
                            $('#danmu').danmu("addDanmu", danmu_ls);
                            $("#DanmuText").append("<p style='margin-bottom:0px;'>" + danmu_from_sql[0][i] + ":" + danmu_from_sql[1][i] + "</p>");
                            $("#DanmuText").scrollTop($("#DanmuText")[0].scrollHeight);
                            console.log(danmu_ls);
                        }
                    }
                });
            }
            //发送弹幕，使用了文档README.md第7节中推荐的方法
            function send() {
                sid = id;
                username = userName;
                console.log(username);
                var text = document.getElementById('text').value;
                var color = "black";
                /*var color = document.getElementById('color').value;*/
                var position = "0";
                /*var position = document.getElementById('position').value;*/
                //var time = $('#danmu').data("nowTime") + 1;
                var time = getime() + 3;
                console.log(time);
                var size = "1";
                /*var size =document.getElementById('text_size').value;*/
                //var text_obj = '{ "text":"' + text + '","color":"' + color + '","size":"' + size + '","position":"' + position + '","time":' + time + '}';
                var text_obj = text;
                $.post("/api/Danmu", { danmu: text_obj, stockId: sid, user: userName });
                var text_obj = '{ "text":"' + text + '","color":"' + color + '","size":"' + size + '","position":"' + position + '","time":' + time + ',"isnew":""}';
                var new_obj = eval('(' + text_obj + ')');
                $('#danmu').danmu("addDanmu", new_obj);
                document.getElementById('text').value = '';
                //$("#DanmuText").append("<p style='margin-bottom:0px;'>" + danmu_from_sql[0][i] + ":" + danmu_from_sql[1][i] + "</p>");
                $("#DanmuText").append("<p style='margin-bottom:0px;'>" + username + ":" + text + "</p>");
                $("#DanmuText").scrollTop($("#DanmuText")[0].scrollHeight);
            }
            //调整透明度函数
            function op() {
                var op = document.getElementById('op').value;
                $('#danmu').danmu("setOpacity", op / 100);
            }
            //调隐藏 显示
            function changehide() {
                var op = document.getElementById('op').value;
                op = op / 100;
                if (document.getElementById("ishide").checked) {
                    $("#danmu").danmu("setOpacity", 1)
                } else {
                    $("#danmu").danmu("setOpacity", 0)

                }
            }
            //设置弹幕时间
            function settime() {
                var t = document.getElementById("set_time").value;
                $('#danmu').danmu("setTime", t);
            }
            var speechContent;
            setInterval("getSubs()", 3000);
            function getSubs() {
                obj = document.getElementById("Subscribe");
                if (obj[obj.selectedIndex].value == "-1")
                {
                    console.log(-1);
                }
                else
                {
                    $.get("/api/Message/?id=" + obj[obj.selectedIndex].value + "&number=1", function (data) {
                        if (speechContent != data[0].Message1)
                        {
                            speechContent = data[0].Message1;
                            htmlContent = "<p class='jcontent'>" + data[0].Message1 + "</p>";
                            $(".jcontent").text(data[0].Message1);
                            $(".jcontent").jspeech({
                                "jspeech_a": false,
                                "jspeech_a_width": "30px"/*"16px"*/,
                                "jspeech_a_height": "13px",
                                /*"jspeech_a_png":"url(./image/icon.png) no-repeat",*/
                                "jspeech_content": data[0].Message1
                            });
                        }
                        
                    })
                }
            };

            // Adding a select onchange func
            function selectSend() {
                var i1 = document.getElementById('selectBox').value;

                var spn = document.getElementById('result');

                if (i1 == "1") 
                    spn.innerHTML = '   天气不错'
                else 
                    spn.innerHTML = '   天气很差'    
            }


        </script>
    


</body></html>
